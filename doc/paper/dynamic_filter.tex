%%%%%%%%%%%%%%%%%%%%%%% file typeinst.tex %%%%%%%%%%%%%%%%%%%%%%%%%
%
% This is the LaTeX source for the instructions to authors using
% the LaTeX document class 'llncs.cls' for contributions to
% the Lecture Notes in Computer Sciences series.
% http://www.springer.com/lncs       Springer Heidelberg 2006/05/04
%
% It may be used as a template for your own input - copy it
% to a new file with a new name and use it as the basis
% for your article.
%
% NB: the document class 'llncs' has its own and detailed documentation, see
% ftp://ftp.springer.de/data/pubftp/pub/tex/latex/llncs/latex2e/llncsdoc.pdf
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[runningheads,a4paper]{llncs}
\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}
\usepackage{url}
\usepackage[utf8]{inputenc}
\usepackage{todonotes}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{subfig}
\usepackage{array}
\usepackage[portuges]{babel}

% \newcommand{\papertitle}{A Distributed Computing Framework for Heterogeneous Environments}


\newcommand{\papertitle}{Filtros dinâmicos}

%\newcommand{\papertitle}{Leveraging GPUs for Scientific Computing}

\hypersetup{pdfborder=0 0 0,
            pdfauthor={Nuno Martins e Vítor Duarte},
%            pdfcreator=,
            pdfkeywords={Pcap, linux, monitorização,},
%            pdfsubject=TesteSubject,
            pdftitle={\papertitle}
           }


\urldef{\mailsa}\path|nuno.m.g.martins@gmail.com|
\urldef{\mailsb}\path|vad@di.fct.unl.pt|    

\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\newcommand{\td}[1]{\todo[inline]{#1}}


\begin{document}

\mainmatter  % start of an individual contribution

% first the title is needed
\title{\papertitle}

\author{Nuno Martins%
\and Vítor Duarte%
\thanks{}%
}
%
\authorrunning{\papertitle}
% (feature abused for this document to repeat the title also on left hand pages)

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
\institute{CITI --- Departamento de Informática,\\
Universidade Nova de Lisboa, Portugal\\
\mailsa \qquad \mailsb}

%
% NB: a more complex sample for affiliations and the mapping to the
% corresponding authors can be found in the file "llncs.dem"
% (search for the string "\mainmatter" where a contribution starts).
% "llncs.dem" accompanies the docume\label{•} nt class "llncs.cls".
%

%\toctitle{Lecture Notes in Computer Science}
%\tocauthor{Authors' Instructions}
\maketitle

\begin{abstract}

%Monitorização de processos dinâmicos têm elevados custos de desempenho.
%Foi criado um novo subsistema de monitorização de rede, que filtra pacotes TCP e UDP de forma dinâmica.

Neste trabalho é efectuado uma minimização do \textit{overhead} introduzido pela monitorização de rede de um processo. Esta minimização é alcançada através da monitorização dinâmica das chamadas ao sistema efectuadas pelos processos e consequente filtragem dos pacotes de rede pertencentes a este de forma a apenas serem capturados os pacotes interessantes fazendo assim reduzir o nº de pacotes copiados e transferidos para a aplicação monitorizadora. Com a redução de transferencias do nº de pacotes reduz-se o nº de trocas de contexto, consequentemente reduz-se o impacto negativo da monitorização.

\keywords{PCap; Linux Kernel; Monitorização}
\end{abstract}



\section{Introdução}
\label{sec:introduction}


\section{Monitorização}
\label{sec:mon_intro}

%apenas os conceitos base
%3/4 parágrafos

A monitorização permite que diferentes partes de um programa ou processo possam ser analisados. Podemos analisar os tempos de execução de terminadas funções ou todo o processo, é possível analisar as interacções que se fazem com o exterior bem como outros parâmetros tais como a percentagem de utilização do(s) cpu(s) ou a utilização de memória.

A monitorização causa perdas no desempenho e por isso é desejável que seja o menor possível. Estas devem-se a que pelo simples facto de se executar uma observação, não estar a fazer trabalho útil para o sistema.

Na monitorização das interacções com o exterior via interfaces de rede é possível verificar que os principais causas da redução de desempenho são as frequentes trocas de contexto, as diferentes cópias de dados.


\section{Monitorização de rede no Linux com recursos a filtros dinâmicos}
\label{sec:mon_network__with_dynamic_filters_linux}
%TODO explicar um pouco mais sobre a monitorização de rede no linux ...como é que acontece

Como anteriormente foi indicado a monitorização de sistemas produz uma perda de desempenho no sistema. Quando se trata de monitorizar processos dinâmicos esta monitorização pode aumentar ainda mais esta perda. O sistema desenvolvido permite que seja monitorizado um processo que faça utilização das chamadas ao sistema sobre a pilha de protocolos TCP/IP.


\section{Desenho e arquitectura}
\label{sec:architecture}

Este sistema foi criado a pensar na modularidade e nas potêncialidades de modificação das diferentes componentes de forma a poder ser modificado, originando possibilidade de aumento de funcionalidades e diferentes desempenhos.

As quatro partes essenciais do sistema são: função de filtragem (ligação a um \textit{hook} ), monitorização das chamadas ao sistema, ou outras funções que estejam no sistema de rede, o repositório de dados e caso seja necessário o sistema de informação de análise da monitorização.

\subsection*{Monitorização das chamadas ao sistema de rede}
\label{sub:mon_syscalls}

Para conseguir detectar todas as interacções que um processo executa com o exterior foi necessário monitorizar as chamadas ao sistema de rede de forma a garantir que todas estas interacções são detectadas. Uma forma de minimizar as trocas de contexto foi efectuar toda a monitorização dentro do kernel. Utilizando o sistema de monitorização KProbes, pertencente ao núcleo do Linux foi possível efectuar esta monitorização. Foram monitorizadas as chamadas ao sistema (\textit{sendto}, \textit{recvfrom}, \textit{bind}, \textit{accept}, \textit{connect} e  \textit{close}).
Apesar de se filtrar qual o processo que está a executar a chamada ao sistema verificou-se que a chamada ao sistema \textit{close} por ser utilizada intensivamente por todo o sistema de ficheiros que poderia ser um ponto onde este sistema iria ter pior desempenho. Por esta razão decidiu-se aplicar a monitorização à função \textit{sock\_close} a monitorização ao invés de ser na função mais genérica \textit{close} e assim permitia que apenas os processos que fizessem uso do sistema de transferência de dados utilizando os métodos de rede. Desta forma foi possível reduzir significativamente o número de eventos de monitorização da chamada ao sistema \textit{close}.

\subsection*{Filtro de pacotes}
\label{sub:packet_filter}

Este sistema de filtros dinâmicos permite que sejam efectuadas monitorizações de rede com e sem o sistema de filtragem de pacotes definidos no \textit{Linux Socket Filter}. De forma a alterar o menos possível a forma como é efectuado a monitorização de rede no Linux, foi colocar um \textit{hook} no sistema de rede. Este \textit{hook} serve para que quando esteja ligado, a monitorização passe pelo sistema dinâmico de filtragem permitindo assim efectuar a nova monitorização sem que se perca os beneficios do \textit{Linux Socket Filter}, pois esta é uma linguagem genérica que permite efectuar alguma análise aos pacotes que estão a ser monitorizados.


\subsection*{Repositório de dados}
\label{sub:data_repository}

Os portos \textit{TCP} ou \textit{UDP} que estão em utilização por um processo necessitam ser guardados num repositório de dados de forma a que quando um pacote chegar à interface de rede, possa ser comparado. 
A estrutura de dados escolhida para este repositório de dados foi uma àrvore \textit{Red and Black}. Como se trata de uma àrvore balanceada é possível obter um bom compromisso de tempo de acesso \textit{versus} quantidade de memória utilizada.

Em cada folha da àrvore existe uma estrutura 

\subsection*{Informação de análise}
\label{sub:data_information}

\section{Avaliação}
\label{sec:evaluation}

Escrever as tabelas actuais ... e verificar quais os dados necessários para outros testes ...
\paragraph*{}

\begin{table}
\caption{Envio de 1GB de dados por ftp}
\begin{tabular}{| c | c | c |}
\hline
\hspace {1cm} Aplicação \hspace {1cm} & Aplicação e TcpDump & Aplicação e TcpDump com módulo \\
\hline
91.8231 & 91.8653 & 92.1157 \\
\hline
\end{tabular}
\end{table}

\begin{center}
\begin{table}
\caption{Envio de 1GB de dados por http}
\begin{tabular}{ | c | c | c  | }
\hline
\hspace {1cm} Aplicação \hspace {1cm} & Aplicação e TcpDump & Aplicação e TcpDump com módulo \\
\hline
91.6948 & 91.6837 & 91.9228 \\
\hline
\end{tabular}
\end{table}
\end{center}

\section{Trabalho Relacionado}
\label{sec:related_work}

\section{Conclusões}
\label{sec:conclusions}


\bibliographystyle{plain}
\bibliography{references}

\end{document}
